(function(v){v.angular.module("wml.isogd").directive("uiMask",[function(){var I={9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/};return{priority:100,require:"ngModel",restrict:"A",link:function(J,e,r,l){function K(){s=!1;n&&(e.unbind("blur",L),e.unbind("mousedown",p),e.unbind("mouseup",p),e.unbind("input",t),e.unbind("keyup",t),e.unbind("click",t),n=!1);angular.isDefined(M)?e.attr("placeholder",M):e.removeAttr("placeholder");angular.isDefined(N)?e.attr("maxlength",N):e.removeAttr("maxlength");e.val(l.$modelValue);
l.$viewValue=l.$modelValue;return!1}function C(a){return a.length?a.length===h.length-1:!0}function z(a){var b="",c=u.slice();angular.forEach(a.toString().split(""),function(a,e){c.length&&c[0].test(a)&&(b+=a,c.shift())});return b}function A(a){var b="",c=h.slice();angular.forEach(m.split(""),function(d,e){a.length&&e===c[0]?(b+=a.charAt(0)||"_",a=a.substr(1),c.shift()):b+=d});return b}function v(a){var b=0;h=[];u=[];m="";a instanceof Array?angular.forEach(a,function(a,d){a instanceof RegExp?(h.push(b++),
m+="_",u.push(a)):"string"==typeof a&&angular.forEach(a.split(""),function(a,c){m+=a;b++})}):"string"===typeof a&&angular.forEach(a.split(""),function(a,d){I[a]?(h.push(b),m+="_",u.push(I[a])):m+=a;b++});h.push(h.slice().pop()+1);s=1<h.length?!0:!1}function L(a){B=D=0;k&&0!==g.length||(E="",e.val(""),J.$apply(function(){l.$setViewValue("")}))}function F(a){B=O(this);e.unbind("mouseout",F)}function p(a){"mousedown"===a.type?e.bind("mouseout",F):e.unbind("mouseout",F)}function t(a){a=a||{which:0,type:"input"};
var b=a.which,c=a.type;if(16==b||91==b)return!0;var d=e,g=d.val(),k=G,q=z(g),s=H,x=!1,f=P(this)||0,r=D||0,n=f-r,w=h[0],p=h[q.length]||h.slice().shift(),t=O(this),y=B||0,u=0<y,v=g.length>k.length||y&&g.length>k.length-y,g=g.length<k.length||y&&g.length==k.length-y;a=37<=b&&40>=b&&a.shiftKey;k=8==b||"keyup"!=c&&g&&-1===n;n=46==b||"keyup"!=c&&g&&0===n&&!u;b=(37==b||k||"click"==c)&&f>w;B=t;if(a||0<t&&("click"==c||"keyup"==c))return!0;if(("input"==c||"propertychange"==c)&&g&&!u&&q===s){for(;k&&0<f&&!(-1<
h.indexOf(f));)f--;for(;n&&f<m.length&&-1==h.indexOf(f);)f++;x=h.indexOf(f);q=q.substring(0,x)+q.substring(x+1);x=!0}G=c=A(q);H=q;d.val(c);x&&J.$apply(function(){l.$setViewValue(q)});v&&f<=w&&(f=w+1);b&&f--;for(f=f>p?p:f<w?w:f;!(-1<h.indexOf(f))&&f>w&&f<p;)f+=b?-1:1;(b&&f<p||v&&!(-1<h.indexOf(r)))&&f++;D=f;Q(this,f)}function P(a){if(void 0!==a.selectionStart)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();b.moveStart("character",-a.value.length);return b.text.length}}
function Q(a,b){if(0===a.offsetWidth||0===a.offsetHeight)return!0;if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}function O(a){if(void 0!==a.selectionStart)return a.selectionEnd-a.selectionStart;if(document.selection)return document.selection.createRange().text.length}var s=!1,n=!1,h,u,m,g,E,k,M=r.placeholder,N=r.maxlength,G,H,D,B;r.$observe("uiMask",function(a){if(!angular.isDefined(a))return K();
v(a);if(!s)return K();g=H=z(l.$modelValue||"");E=G=A(g);viewValue=(k=C(g))&&g.length?E:"";r.maxlength&&e.attr("maxlength",2*h[h.length-1]);e.attr("placeholder",m);e.val(viewValue);l.$viewValue=viewValue;n||(e.bind("blur",L),e.bind("mousedown mouseup",p),e.bind("input keyup click",t),n=!0)});l.$formatters.push(function(a){if(!s)return a;g=z(a||"");k=C(g);l.$setValidity("mask",k);return k?A(g):void 0});l.$parsers.push(function(a){if(!s)return a;g=z(a||"");k=C(g);viewValue=g.length?A(g):"";l.$viewValue=
viewValue;l.$setValidity("mask",k);""===g&&void 0!==l.$error.required&&l.$setValidity("required",!1);return k?g:void 0});e.bind("mousedown mouseup",p);Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;1<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&Infinity!==d&&-Infinity!==d&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=0<=d?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in
b&&b[d]===a)return d;return-1})}}}])})(this);
